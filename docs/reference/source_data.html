<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>source_data : exécute le code et cache les données — source_data • ofce</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="source_data : exécute le code et cache les données — source_data"><meta name="description" content="Cette fonction s'utilise presque comme source et permet d'en accélérer l'exécution par le cache des données."><meta property="og:description" content="Cette fonction s'utilise presque comme source et permet d'en accélérer l'exécution par le cache des données."><meta property="og:image" content="https://ofce.github.io/ofce/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ofce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-manuels" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Manuels</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-manuels"><li><a class="dropdown-item" href="../articles/site.html">Sites dédiés</a></li>
    <li><a class="dropdown-item" href="../articles/blog.html">Le Blog</a></li>
    <li><a class="dropdown-item" href="../articles/quarto.html">Ecrire un texte en quarto</a></li>
    <li><a class="dropdown-item" href="../articles/graphiques.html">Faire un graphique</a></li>
    <li><a class="dropdown-item" href="../articles/tableaux.html">Faire un tableau</a></li>
    <li><a class="dropdown-item" href="../articles/outils.html">Les outils</a></li>
    <li><a class="dropdown-item" href="../articles/semio.html">Le language des graphiques</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutoriaux" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutoriaux</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutoriaux"><li><a class="dropdown-item" href="../articles/charte_graphique.html">Charte Graphique</a></li>
    <li><a class="dropdown-item" href="../articles/temporelles.html">Séries temporelles</a></li>
    <li><a class="dropdown-item" href="../ar%20%20%20%20ticles/xy.html">Graphiques XY</a></li>
    <li><a class="dropdown-item" href="../articles/categories.html">Barres empilées, wafle, treemap, lollypop</a></li>
    <li><a class="dropdown-item" href="../articles/distributions.html">Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/cartes.html">Cartes</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ofce/ofce"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>source_data : exécute le code et cache les données</h1>
      <small class="dont-index">Source: <a href="https://github.com/ofce/ofce/blob/HEAD/R/source_data.R" class="external-link"><code>R/source_data.R</code></a></small>
      <div class="d-none name"><code>source_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Cette fonction s'utilise presque comme source et permet d'en accélérer l'exécution par le cache des données.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">source_data</span><span class="op">(</span></span>
<span>  <span class="va">name</span>,</span>
<span>  relative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.relative"</span><span class="op">)</span>,</span>
<span>  cache_rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.cache_rep"</span><span class="op">)</span>,</span>
<span>  hash <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.hash"</span><span class="op">)</span>,</span>
<span>  lapse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.lapse"</span><span class="op">)</span>,</span>
<span>  force_exec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.force_exec"</span><span class="op">)</span>,</span>
<span>  prevent_exec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.prevent_exec"</span><span class="op">)</span>,</span>
<span>  metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.metadata"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>(character) le chemin vers le code à exécuter (sans extension .r ou .R), ce chemin doit être relatif au projet (voir relative), bien que une recherche sera effectuée</p></dd>


<dt id="arg-relative">relative<a class="anchor" aria-label="anchor" href="#arg-relative"></a></dt>
<dd><p>(character) Si "projet" le chemin est supposé relatif au projet, sinon le chemin sera dans le répertoire de travail (attention il peut changer)</p></dd>


<dt id="arg-cache-rep">cache_rep<a class="anchor" aria-label="anchor" href="#arg-cache-rep"></a></dt>
<dd><p>(character) Le chemin du dossier dans lequel sont enregistré les caches (défaut _data)</p></dd>


<dt id="arg-hash">hash<a class="anchor" aria-label="anchor" href="#arg-hash"></a></dt>
<dd><p>(boléen) Si TRUE (défaut) un changement dans le code déclenche son exécution</p></dd>


<dt id="arg-lapse">lapse<a class="anchor" aria-label="anchor" href="#arg-lapse"></a></dt>
<dd><p>(character) peut être "never" (défaut) "x hours", "x days", "x weeks", "x months", "x quarters", "x years"</p></dd>


<dt id="arg-force-exec">force_exec<a class="anchor" aria-label="anchor" href="#arg-force-exec"></a></dt>
<dd><p>(boléen) Si TRUE alors le code est exécuté ($FORCE_EXEC par défaut)</p></dd>


<dt id="arg-prevent-exec">prevent_exec<a class="anchor" aria-label="anchor" href="#arg-prevent-exec"></a></dt>
<dd><p>(boléen) Si TRUE alors le code n'est pas exécuté ($PREVENT_EXEC par défaut), ce flag est prioritaire sur les autres, sauf si il n'y a pas de données en cache</p></dd>


<dt id="arg-metadata">metadata<a class="anchor" aria-label="anchor" href="#arg-metadata"></a></dt>
<dd><p>(boléen) Si TRUE (FALSE par défaut) la fonction retourne une liste avec des métadonnées et le champ data qui contient les données elles même</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data (list ou ce que le code retourne)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Le code est exécuté (dans un environnement local) et le résultat est mis en cache. Il est important que le code se termine par un return(les_données).
Si return() n'est pas présent dans le code, il n'est pas exécuté et un message d'erreur est envoyé ("NULL" est retourné).
le code est exécuté avec un contrôle d'erreur, donc si il bloque, "NULL" est renvoyé, mais sans erreur ni arrêt.
les appels suivants seront plus rapides et sans erreur.</p>
<p>Une modification du code est détectée et déclenche l'éxécution</p>
<p>Suivant le paramètre lapse on peut déclencher une exécution péridique. Par exemple, pour ne pas rater une MAJ, on peut mettre lapse = "1 day" ou "day" et une fois par jour le code sera exécuté.
Cela permet d'éviter une exécution à chaque rendu.</p>
<p>On peut bloquer l'exécution en renseignant la variable d'environnement "PREVENT_EXEC" pas Sys.setenv(PREVENT_EXEC = "TRUE") ou dans .Renviron.
Ce blocage est prioritaire sur tous les autres critères (sauf en cas d'absence de cache).</p>
<p>Des métadonnées peuvent être renvoyées (paramètre metadata) avec la date d'exécution ($date), le temps d'exécution ($timing),
la taille des données ($size), le chemin de la source ($where), le hash du source ($hash) et bine sûr les données ($data)</p>
<p>Les valeurs par défaut peuvent être modifiées simplement par options(ofce.source_data.hash = FALSE) par exemple et persiste pendant une session.
Typiquement cela peut être mis dans rinit.r (et donc être exécuté par ofce::init_qmd())</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Malliet, Anissa Saumtally, Xavier Timbeau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>RTFM CC BY 4.0 Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

