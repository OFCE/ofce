<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>source_data : exécute le code et cache les données — source_data • ofce</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="source_data : exécute le code et cache les données — source_data"><meta name="description" content="Cette fonction s'utilise presque comme source et permet d'en accélérer l'exécution par le cache des données."><meta property="og:description" content="Cette fonction s'utilise presque comme source et permet d'en accélérer l'exécution par le cache des données."><meta property="og:image" content="https://ofce.github.io/ofce/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ofce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-manuels" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Manuels</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-manuels"><li><a class="dropdown-item" href="../articles/site.html">Sites dédiés</a></li>
    <li><a class="dropdown-item" href="../articles/blog.html">Le Blog</a></li>
    <li><a class="dropdown-item" href="../articles/quarto.html">Ecrire un texte en quarto</a></li>
    <li><a class="dropdown-item" href="../articles/graphiques.html">Faire un graphique</a></li>
    <li><a class="dropdown-item" href="../articles/tableaux.html">Faire un tableau</a></li>
    <li><a class="dropdown-item" href="../articles/outils.html">Les outils</a></li>
    <li><a class="dropdown-item" href="../articles/semio.html">Le language des graphiques</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutoriaux" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutoriaux</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutoriaux"><li><a class="dropdown-item" href="../articles/charte_graphique.html">Charte Graphique</a></li>
    <li><a class="dropdown-item" href="../articles/temporelles.html">Séries temporelles</a></li>
    <li><a class="dropdown-item" href="../articles/xy.html">Graphiques XY</a></li>
    <li><a class="dropdown-item" href="../articles/categories.html">Barres empilées, wafle, treemap, lollypop</a></li>
    <li><a class="dropdown-item" href="../articles/distributions.html">Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/cartes.html">Cartes</a></li>
    <li><a class="dropdown-item" href="../articles/prevision.html">Charte graphique de la prévision</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ofce/ofce"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>source_data : exécute le code et cache les données</h1>

      <div class="d-none name"><code>source_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Cette fonction s'utilise presque comme source et permet d'en accélérer l'exécution par le cache des données.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">source_data</span><span class="op">(</span></span>
<span>  <span class="va">path</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  hash <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.hash"</span><span class="op">)</span>,</span>
<span>  track <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lapse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.lapse"</span><span class="op">)</span>,</span>
<span>  force_exec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.force_exec"</span><span class="op">)</span>,</span>
<span>  prevent_exec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.prevent_exec"</span><span class="op">)</span>,</span>
<span>  metadata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.metadata"</span><span class="op">)</span>,</span>
<span>  wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.wd"</span><span class="op">)</span>,</span>
<span>  src_in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ofce.source_data.src_in"</span><span class="op">)</span>,</span>
<span>  exec_wd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cache_rep <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  root <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nocache <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>(character) le chemin vers le code à exécuter (sans extension .r ou .R ou avec au choix), ce chemin doit être relatif au projet (voir détails)</p></dd>


<dt id="arg-args">args<a class="anchor" aria-label="anchor" href="#arg-args"></a></dt>
<dd><p>(list) une liste d'arguments que l'on peut utliser dans source (args$xxx)</p></dd>


<dt id="arg-hash">hash<a class="anchor" aria-label="anchor" href="#arg-hash"></a></dt>
<dd><p>(boléen) Si TRUE (défaut) un changement dans le code déclenche son exécution</p></dd>


<dt id="arg-track">track<a class="anchor" aria-label="anchor" href="#arg-track"></a></dt>
<dd><p>(list) une liste de fichiers (suivant la même règle que src pour les trouver) qui déclenchent l'exécution.</p></dd>


<dt id="arg-lapse">lapse<a class="anchor" aria-label="anchor" href="#arg-lapse"></a></dt>
<dd><p>(character) peut être "never" (défaut) "x hours", "x days", "x weeks", "x months", "x quarters", "x years"</p></dd>


<dt id="arg-force-exec">force_exec<a class="anchor" aria-label="anchor" href="#arg-force-exec"></a></dt>
<dd><p>(boléen) Si TRUE alors le code est exécuté.</p></dd>


<dt id="arg-prevent-exec">prevent_exec<a class="anchor" aria-label="anchor" href="#arg-prevent-exec"></a></dt>
<dd><p>(boléen) Si TRUE alors le code n'est pas exécuté, ce flag est prioritaire sur les autres, sauf si il n'y a pas de données en cache</p></dd>


<dt id="arg-metadata">metadata<a class="anchor" aria-label="anchor" href="#arg-metadata"></a></dt>
<dd><p>(boléen) Si TRUE (FALSE par défaut) la fonction retourne une liste avec des métadonnées et le champ data qui contient les données elles même</p></dd>


<dt id="arg-wd">wd<a class="anchor" aria-label="anchor" href="#arg-wd"></a></dt>
<dd><p>(character) si 'project' assure que le wd est le root du project, si 'file' (défaut) c'est le fichier sourcé qui est le wd, si "qmd", c'est le qmd qui appelle</p></dd>


<dt id="arg-exec-wd">exec_wd<a class="anchor" aria-label="anchor" href="#arg-exec-wd"></a></dt>
<dd><p>(character) NULL par défaut sauf usage particulier</p></dd>


<dt id="arg-cache-rep">cache_rep<a class="anchor" aria-label="anchor" href="#arg-cache-rep"></a></dt>
<dd><p>(character) défaut .data sauf usage particulier</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(boléen) pas de messages</p></dd>


<dt id="arg-nocache">nocache<a class="anchor" aria-label="anchor" href="#arg-nocache"></a></dt>
<dd><p>(boléen) n'enregistre pas le cache même si nécessaire</p></dd>


<dt id="arg-scr-in">scr_in<a class="anchor" aria-label="anchor" href="#arg-scr-in"></a></dt>
<dd><p>(character) si "project" cherche le source dans le projet puis les sous dossiers, si "file" cherche dans le dossier du qmd (ou le wd). Dans ce cas, les données sont stockées dans le dossier en question.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data (list ou ce que le code retourne)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Le fichier source est donné en entrée. Le chemin est relatif au projet, mais si il n'est pas trouvé dans le projet, il est cherché en partant de la racine.
Si le paramètre <code>src_in</code> est mis à <code>"file"</code>, alors le source est cherché à partir du qmd (ou du wd si il n'y pas encore de qmd) et les données sont stockées à ce niveau.
Ce cas correspond donc à des dossiers qui ne partagent pas de code (le blog de l'OFCE), alors que l'autre cas correspond à des codes pouvant être partagés (la prévision)</p>
<p>Le code est exécuté (dans un environnement local) et le résultat est mis en cache. Il est important que le code se termine par un return(les_donnees).
Si return() n'est pas présent dans le code, il n'est pas exécuté et un message d'erreur est envoyé ("NULL" est retourné).
le code est exécuté avec un contrôle d'erreur, donc si il bloque, "NULL" est renvoyé, mais sans erreur ni arrêt.
les appels suivants seront plus rapides et sans erreur (sauf si l'erreur n'est pas corrigée).</p>
<p>Une modification du code est détectée et déclenche l'éxécution automatiquement.</p>
<p>Suivant le paramètre lapse on peut déclencher une exécution périodique.
Par exemple, pour ne pas rater une MAJ, on peut mettre <code>lapse = "1 day"</code> ou <code>"day"</code> et une fois par jour le code sera exécuté.
Cela permet d'éviter une exécution à chaque rendu, mais permet de vérifier fréquemment la MAJ.
On peut spécifier l'intervalle en heures (<code>hours</code>), en jours (<code>days</code>), en semaines (<code>weeks</code>), en mois (<code>months</code>) ou en trimestres (<code>quarters</code>).</p>
<p>On peut bloquer l'exécution en renseignant la variable d'environnement <code>PREVENT_EXEC</code> par <code>Sys.setenv(PREVENT_EXEC = "TRUE")</code> ou dans <code>.Renviron</code>.
Ce blocage est prioritaire sur tous les autres critères (sauf en cas d'absence de cache ou l'exécution est essayée).</p>
<p>Des métadonnées peuvent être renvoyées (paramètre <code>metadata</code>) avec la date de la dernière exécution (<code>$date</code>), le temps d'exécution (<code>$timing</code>),
la taille des données (<code>$size</code>), le chemin de la source (<code>$where</code>), le hash du source (<code>$hash_src</code>) et bien sûr les données (<code>$data</code>).
Cela peut servir pour renseigner un graphique.</p>
<p>Les valeurs par défaut peuvent être modifiées simplement par <code>options(ofce.source_data.hash = FALSE)</code> par exemple et persistent pour une session.
Typiquement cela peut être mis dans rinit.r (et donc être exécuté par <code><a href="init_qmd.html">ofce::init_qmd()</a></code>) et cela sera l'option par défaut du projet.</p>
<p>Le paramètre <code>wd</code> perment de spécifier le répertoire d'exécution du source.
Si il est mis à <code>"file"</code>, les appels à l'intérieur du code source, comme par exemple un save ou un load seront compris dans le répertoire où se trouve le fichier source.
L'intérêt est que le code peut avoir des éléments persistants, locaux
L'alternative est d'utiliser <code>wd="project"</code> auquel cas, le répertoire d'exécution sera independant de l'endroit où est appelé le code source.
Les éléments persistants peuvent alors être dasn un endroit commun et le code peut appeler des éléments persistants d'autres codes sources.
En le mettant à <code>qmd</code>l'exécution part du fichier qmd, ce qui est le comportement standard de <code>quarto</code>.
Toute autre valeur pour wd laisse le working directory inchnagé et donc dépendant du contexte d'exécution. Pour ceux qui aiment l'incertitude.</p>
<p>En donnant des fichers à suivre par <code>track</code>, on peut déclencher l'exécution du source lorsque ces fichiers sont modifiés, c'est utile pour des fichiers sources sous excel (ou csv).</p>
<p><code>unfreeze</code> permet d'invalider le cache de quarto et de déclencher l'exécution du qmd pour mettre à jour la publication (et pas seulement les données en cache).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other source_data:
<code><a href="clear_source_cache.html">clear_source_cache</a>()</code>,
<code><a href="set_cache_rep.html">set_cache_rep</a>()</code>,
<code><a href="source_data_refresh.html">source_data_refresh</a>()</code>,
<code><a href="source_data_status.html">source_data_status</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Malliet, Anissa Saumtally, Xavier Timbeau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>RTFM CC BY 4.0 Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

