<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Recommandations pour les graphiques OFCE • ofce</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Recommandations pour les graphiques OFCE">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ofce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/site.html">Sites dédiés</a></li>
    <li><a class="dropdown-item" href="../articles/blog.html">Le blog</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/quarto.html">Premiers pas en Quarto</a></li>
    <li><a class="dropdown-item" href="../articles/graphiques.html">Graphiques</a></li>
    <li><a class="dropdown-item" href="../articles/tableaux.html">Tableaux</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/outils.html">Outils</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Recommandations pour les graphiques OFCE</h1>
            
      

      <div class="d-none name"><code>graphiques.Rmd</code></div>
    </div>

    
    
<p>Dans cette (longue) vignette, les recommandations pour les graphiques
sont détaillées.</p>
<p>On commence par des éléments généraux (les 3 méthodes), puis des
recommandations (une charte graphique) pour les diférents types de
graphiques (séries temporelles, catégories, etc) qui sont les plus
fréquents.</p>
<div class="section level2">
<h2 id="les-trois-méthodes">Les trois méthodes<a class="anchor" aria-label="anchor" href="#les-trois-m%C3%A9thodes"></a>
</h2>
<p>Pour les graphiques on dispose de plusieurs options :
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>, copier-coller, fichier image.</p>
<div class="section level3">
<h3 id="ggplot2">ggplot2<a class="anchor" aria-label="anchor" href="#ggplot2"></a>
</h3>
<p>La façon préférée de faire un graphique est <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>.
Elle est la plus flexible, permet d’avoir une source unique, peut être
facilement modifiée (uniformisation, traduction, correction,
raffinements) et s’intègre parfaitement en html et en pdf.</p>
<p>Avec un faible coût on peut rendre le graphique interactif (avec
<a href="https://plotly-r.com" class="external-link">plotly</a> ou <a href="https://davidgohel.github.io/ggiraph/" class="external-link">ggiraph</a>).</p>
<p>Un graphique <code>ggplot</code> doit contenir une couche (layer)
<code><a href="../reference/theme_ofce.html">theme_ofce()</a></code> et limiter au maximum les définitions de
taille (par exemple de police de caractère). Ces définitions doivent
être faites de façon globale pour assurer l’homogénéité. <strong>Il est
important de ne pas définir la taille de la figure, ça risque de
produire des images avec des caractères trop petits</strong>.</p>
<p>Pour changer les dimensions d’un graphique, il faut utiliser<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;donc on n’utilise pas &lt;code&gt;#| fig-width&lt;/code&gt; ou
&lt;code&gt;fig-height&lt;/code&gt;.&lt;/p&gt;"><sup>1</sup></a>
<code>#| fig-asp : x</code> ou <code>x</code> est le ratio entre la
hauteur et la longueur. 0.61 est la valeur par défaut et correspond au
nombre d’or soit entre 16/9 et 16/10. Pour des graphiques particuliers
(par exemple deux graphiques empilés ou une carte) on peut mettre 1
(format carré) ou 1.4 quand on veut prendre toute la page A4.</p>
<p>Le code d’un graphique <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| label: fig-tauxapp</span></span>
<span><span class="co">#| fig-cap: Taux de taxation apparent sur le patrimoine des ménages</span></span>
<span><span class="co">#| fig-asp: 0.61</span></span>
<span><span class="co"># pas besoin d'en mettre plus, echo, message, warning sont déjà définis</span></span>
<span><span class="co"># les données sont dans excel -- elles pourraient venir de R ou d'ailleurs</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="st">"analyses/Tables/patrimoine menages.v2.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"tapp"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"vn"</span>, <span class="st">"pib"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ym</a></span><span class="op">(</span><span class="fu">str_c</span><span class="op">(</span><span class="va">date</span>, <span class="st">"-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vn</span>, <span class="va">pib</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vn"</span>, <span class="st">"pib"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"En % de la valeur nette"</span>, <span class="st">"En % du PIB"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                       </span>
<span><span class="co"># un ggplot et ses différentes couches</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">name</span>, col <span class="op">=</span> <span class="va">name</span>, fill <span class="op">=</span> <span class="va">name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, col <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># important utiliser le theme_ofce pour uniformiser l'aspect des graphiques</span></span>
<span>  <span class="fu"><a href="../reference/theme_ofce.html">theme_ofce</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scale date est important lorsqu'on présente des données temporelles</span></span>
<span>  <span class="co"># il faut penser à convertir les dates en dates (as.Date() ou lubridate::ymd() et consorts)</span></span>
<span>  <span class="co"># c'est important même si les dates ne sont que des années</span></span>
<span>  <span class="co"># ca permet aussi de mélanger facilement des fréquences différentes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 years"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span>, </span>
<span>               date_minor_breaks <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># le choix des couleurs est tjrs délicat, Paul Malliet est un maître en la matière</span></span>
<span>  <span class="co"># uniformiser ses choix de couleurs le long d'un document c'est bien</span></span>
<span>  <span class="co"># donner une signification à ses couleurs c'est mieux</span></span>
<span>  <span class="co"># quand en plus c'est harmonieux, c'est PM (plus que mieux ou Paul Malliet)</span></span>
<span>  <span class="fu">PrettyCols</span><span class="fu">::</span><span class="fu"><a href="https://nrennie.github.io/PrettyCols/reference/scale_color_pretty_d.html" class="external-link">scale_color_pretty_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, palette <span class="op">=</span> <span class="st">"Summer"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">PrettyCols</span><span class="fu">::</span><span class="fu"><a href="https://nrennie.github.io/PrettyCols/reference/scale_fill_pretty_d.html" class="external-link">scale_fill_pretty_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, palette <span class="op">=</span> <span class="st">"Summer"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"%"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># les sources -- notez qu'on ne met pas de titre au graphique </span></span>
<span>  <span class="co"># (voir la section références croisées)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span></span>
<span>         <span class="st">"La fiscalité sur le patrimoine est composée ici de la taxe foncière payée par les ménages, &lt;br&gt;</span></span>
<span><span class="st">       des droits d'enregistrement sur les transactions immobilières, des droits de mutation sur les successions et les donations et de l'Impôt sur la Fortune Immobilière (ex-ISF)&lt;br&gt;</span></span>
<span><span class="st">       *Sources* : Insee, calculs OFCE"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="copier-coller">Copier-coller<a class="anchor" aria-label="anchor" href="#copier-coller"></a>
</h3>
<p>On peut copier coller un graphique (de word, d’excel, d’ailleurs)
dans le mode visuel de RStudio. Ça marche mais c’est pas le mieux. Quand
on copie colle, on fait quelque chose qui ressemble à l’option qui
suit.</p>
</div>
<div class="section level3">
<h3 id="image-au-format-pngjpegjpgsvg">Image au format png/jpeg/jpg/svg<a class="anchor" aria-label="anchor" href="#image-au-format-pngjpegjpgsvg"></a>
</h3>
<p>On peut enregistrer une image (au format que l’on veut,
<code>quarto</code> accepte pas mal d’options, dont les plus courantes)
et l’insérer dans le texte. Il y a deux façon de faire soit en
<code>markdown</code> (dans le qmd, comme un lien ou autre chose), soit
en utilisant <code>include_graphics</code>. L’intérêt par rapport au
copier-coller est que si on change le fichier qui contient l’image, à
chaque <em>render</em> du document, la bonne (la dernière version) image
sera utilisée. Si on utilise des images venant de <code>eviews</code> 💀
ou <code>stata</code> 😵, c’est la meilleure méthode.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">[</span><span class="ot">Titre de la figure</span><span class="co">](rep/fig.png)</span></span></code></pre></div>
<p>Le <strong>répertoire est toujours relatif</strong>.</p>
<p><em>Jamais de chemin absolu</em> comme
“<code>c:/user/machin/montravail/monrepo/monimage.png</code>” parce que
ça ne marchera pas sur un autre ordinateur et en plus
<code>github</code> ne copiera pas l’image) et par celui qui contient le
<code>.qmd</code>. Il est toujours possible de mettre les images dans un
sous dossier.</p>
<p>Plus c’est simple et clair, mieux c’est (i.e. gardez les noms courts,
explicites, pas de majuscules, bien rangés, conservateurs dans
l’utilisation des caractères (<strong>pas d’accents, pas de blancs, pas
de symboles spéciaux</strong>). Donc <code>donnees/img.png</code> ou
<code>donnees/graphique 1a5.png</code> ne sont pas des bons noms. Mais
<code>figures/revenu.png</code> ou <code>figures/pib_par_tete.png</code>
sont mieux.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| label fig-pib2008_2024</span></span>
<span><span class="co">#| fig-cap: PIB entre 2008 et 2024</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"pib2008_2024.png"</span><span class="op">)</span></span></code></pre></div>
<p>Notez la cohérence des id, nom et titre.</p>
</div>
</div>
<div class="section level2">
<h2 id="les-types-de-graphiques">Les types de graphiques<a class="anchor" aria-label="anchor" href="#les-types-de-graphiques"></a>
</h2>
<div class="section level3">
<h3 id="séries-temporelles">Séries temporelles<a class="anchor" aria-label="anchor" href="#s%C3%A9ries-temporelles"></a>
</h3>
<div class="section level4">
<h4 id="données">données<a class="anchor" aria-label="anchor" href="#donn%C3%A9es"></a>
</h4>
<p>Pour les séries temporelles, il y a deux recommandations pour les
données :</p>
<ol style="list-style-type: decimal">
<li><p>utilisez le format long pour le graphique. Il peut être plus
simple pour calculer des taux de croissance ou des ratios de passer en
format large, mais c’est mieux de passer en format long pour la partie
graphique, avec une ou plusieurs colonnes pour différencier les lignes.
Cela permettra d’associer une couleur à chaque série et une facette à
chque pays par exemple.</p></li>
<li><p>le champ décrivant les dates doit être en type <code>date</code>.
ce n’est pas toujours évident quand les séries sont à fréquence
annuelle, mais c’est très utile pour mélanger des séries de fréquence
irrégulière, pour homogénéiser l’aspect des axes de dates ert mieux
maîtriser le formatage des dates. Pour convertir une date en date, soit
elle est au format charactere et de type “2022-12-01” et la fonction
<code><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">base::as.Date()</a></code> fonctionne très bien. Sinon, pur les autres
cas, le package <a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a> (formation R niv. 1) est très
pratique et dispose de plein de fonctions permettant d’absorber beaucoup
de cas (les fonctions sont par exemple <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::ymd</a></code>
<code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::dmy</a></code> <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::my</a></code> etc…).</p></li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2023</span>, <span class="fl">2024</span>, <span class="fl">2025</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span>, format  <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2023-07-07" "2024-07-07" "2025-07-07"</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/2023"</span>, <span class="st">"2/2024"</span>, <span class="st">"3/2025"</span><span class="op">)</span></span>
<span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">my</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2023-01-01" "2024-02-01" "2025-03-01"</span></span></code></pre></div>
<p>Prenons l’exemple du graphiques sur les spreads (legislatives2024,
Blot Gerrolf Plane). Les données sont égénrées par un scrapping sur
investing.com (en attendant une solution API sur une banque de données
bien faite). Les données se présentent sous la forme.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"data/spreads.rds"</span><span class="op">)</span></span>
<span><span class="va">spreads</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10,117 × 3</span></span></span>
<span><span class="co">#&gt;    date       pays        taux</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2007-01-02 spreadfra 0.013<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2007-01-03 spreadfra 0.036<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2007-01-04 spreadfra 0.028<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2007-01-05 spreadfra 0.019<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2007-01-08 spreadfra 0.044<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2007-01-09 spreadfra 0.043<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2007-01-10 spreadfra 0.029<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2007-01-11 spreadfra 0.037<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2007-01-12 spreadfra 0.034<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2007-01-15 spreadfra 0.038<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10,107 more rows</span></span></span></code></pre></div>
<p>Le fichier est au format long (avec deux modalités pour
<code>pays</code>), les dates sont au format <code>&lt;date&gt;</code>,
donc tout va presque bien. La colonne <code>pays</code> est un peu
brute. On la transforme pour avoir un label plus propre et en facteur,
pour contrôler l’ordre (on met France en premier, Italie en second). Il
y a plusieurs méthodes pour arriver à ce résultat. Ici, on reste très
simple parce qu’il n’y a que deux modalités. Si il y en avait plus de
deux (et surtout un grand nombre, possiblement évolutif), on aurait fait
quelques manipulations de chaînes et on aurait utilisé le package
<a href="https://vincentarelbundock.github.io/countrycode/" class="external-link">countrycode</a> pour transformer les code pays en texte
lisible, possiblement traduit dans différentes langues.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spreads</span> <span class="op">&lt;-</span> <span class="va">spreads</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">pays</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spreadfra"</span>, <span class="st">"spreadita"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"France"</span>, <span class="st">"Italie"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spreads</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10,117 × 3</span></span></span>
<span><span class="co">#&gt;    date       pays     taux</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2007-01-02 France 0.013<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2007-01-03 France 0.036<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2007-01-04 France 0.028<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2007-01-05 France 0.019<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2007-01-08 France 0.044<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2007-01-09 France 0.043<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2007-01-10 France 0.029<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2007-01-11 France 0.037<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2007-01-12 France 0.034<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2007-01-15 France 0.038<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 10,107 more rows</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="la-base">la base<a class="anchor" aria-label="anchor" href="#la-base"></a>
</h4>
<p>Le graphique de base est alors simple à contruire. On utilise une
couche <code>geom_line</code> et <code>geom_point</code>, une couche
<code>aes</code> avec comme <code>x</code> les dates, <code>y</code> les
taux et couleurs les pays. Pour <code>geom_line</code>, il faut préciser
le groupe (cela peut paraître redondant, mais cela peut servir si on
veut colorer en fonction d’une autre variable).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ofce</span><span class="op">)</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu">PrettyCols</span><span class="fu">::</span><span class="fu"><a href="https://nrennie.github.io/PrettyCols/reference/prettycols.html" class="external-link">prettycols</a></span><span class="op">(</span><span class="st">"Summer"</span>, n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">date_maj</span> <span class="op">&lt;-</span> <span class="st">"2024-07-01"</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spreads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">taux</span>, color<span class="op">=</span><span class="va">pays</span>, group<span class="op">=</span><span class="va">pays</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.75</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>stroke <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="va">cc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y<span class="op">=</span><span class="st">"Ecart de taux à 10 ans en %"</span>,</span>
<span>    x<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>    caption<span class="op">=</span><span class="st">"Source: investing.com"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_ofce.html">theme_ofce</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>minor.ticks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>minor.ticks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"*Source* : investing.com&lt;br&gt;Mis à jour : {date_maj}"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html" class="external-link">label_date_short</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               date_breaks <span class="op">=</span> <span class="st">"5 years"</span><span class="op">)</span></span>
<span><span class="va">main</span></span>
<span><span class="co">#&gt; Warning: Removed 858 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="graphiques_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>On utilise la palette <code>summer</code> de
<a href="https://nrennie.rbind.io/PrettyCols/" class="external-link">PrettyCols</a> (affaire de goût). On utilise la fonction
<code><a href="../reference/theme_ofce.html">theme_ofce()</a></code> pour homogénéiser la présentation des
graphiques. On précise les labels des axes inutile pour <code>x</code>,
explicite pour <code>y</code>. Et la source, en notant que l’on peut
utiliser <code>markdown</code> dans le texte de la source, ce qui permet
de mettre <em>Source</em> en italique.</p>
<p>Le recours à <code>scale_x_date</code> permet de spécifier facilement
le format des dates (avec la syntaxe de <code><a href="https://rdrr.io/r/base/strptime.html" class="external-link">base::strptime()</a></code>)
et la fonction <code>scale::label_date_short()</code> permet un
formatage élégant des dates (voir plus bas la partie insert).</p>
<p>On ajoute au graphique des annotations. C’est ici faid de façon
laborieuse, on peut construire des fonctions (formation R niv. 2) ou
utiliser <a href="https://dreamrs.github.io/esquisse/" class="external-link">esquisse</a> ou <code>{gganotate}</code> mais ces
deux solutions ont des défauts.</p>
</div>
<div class="section level4">
<h4 id="les-annotations">les annotations<a class="anchor" aria-label="anchor" href="#les-annotations"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotations</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-12-01"</span><span class="op">)</span>, y<span class="op">=</span> <span class="fl">1</span>, </span>
<span>    label<span class="op">=</span><span class="st">"France"</span> , color<span class="op">=</span><span class="va">cc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> , size<span class="op">=</span><span class="fl">3</span>, fontface <span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-06-01"</span><span class="op">)</span>, y<span class="op">=</span> <span class="fl">3</span> ,</span>
<span>    label<span class="op">=</span><span class="st">"Italie"</span> , color<span class="op">=</span><span class="va">cc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, size<span class="op">=</span><span class="fl">3</span>, fontface <span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2009-12-01"</span><span class="op">)</span>, </span>
<span>    y<span class="op">=</span> <span class="fl">5</span> , </span>
<span>    label<span class="op">=</span><span class="st">"Crise des dettes souveraines\n26 juillet 2012 : Mario Draghi \n 'Whatever it takes'"</span> ,</span>
<span>    color<span class="op">=</span> <span class="st">"grey33"</span>, </span>
<span>    size<span class="op">=</span><span class="fl">2</span>,</span>
<span>    hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>, </span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-03-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-07-01"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">5</span>, </span>
<span>    yend <span class="op">=</span> <span class="fl">4.6</span>, </span>
<span>    colour <span class="op">=</span> <span class="st">"grey33"</span>,</span>
<span>    linewidth<span class="op">=</span><span class="fl">0.25</span>,</span>
<span>    arrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"point"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-9-01"</span><span class="op">)</span>,</span>
<span>    y<span class="op">=</span> <span class="fl">4.5</span> ,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    label<span class="op">=</span><span class="st">"4 mars 2018 : Élections italiennes\n1er juin : gouvernement de coalition"</span> ,</span>
<span>    color<span class="op">=</span> <span class="st">"grey33"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-09-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-05-01"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">4.2</span>,</span>
<span>    yend <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey33"</span>, </span>
<span>    linewidth<span class="op">=</span><span class="fl">0.25</span>, </span>
<span>    arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"point"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, </span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    y<span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>    label<span class="op">=</span><span class="st">"Annonce de la dissolution"</span> , </span>
<span>    color<span class="op">=</span> <span class="st">"grey33"</span>,</span>
<span>    size<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-03-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-04-01"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>    yend <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>    colour <span class="op">=</span> <span class="st">"grey33"</span>,</span>
<span>    linewidth<span class="op">=</span><span class="fl">0.25</span>,</span>
<span>    arrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"point"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">main</span> <span class="op">+</span> <span class="va">annotations</span></span>
<span><span class="co">#&gt; Warning: Removed 858 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="graphiques_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Le résultat est intéressant, mais le graphique a cependant un défaut,
il y a trop de points, ce qui est du à la fréquence quotidienne et donc
il perd en clarté. On va donc faire deux choses : réduire la fréquence
en agrégeant les données par mois, puis on va ajouter un insert.</p>
</div>
<div class="section level4">
<h4 id="fréquence-mensuelle-et-insert">fréquence mensuelle et insert<a class="anchor" aria-label="anchor" href="#fr%C3%A9quence-mensuelle-et-insert"></a>
</h4>
<p>Pour construire les données à la fréquence mensuelle, on va créer un
champ de date, mais retenant une seule date par mois (au milieu du
mois).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="va">spreads</span><span class="op">$</span><span class="va">date</span></span>
<span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">spreads_m</span> <span class="op">&lt;-</span> <span class="va">spreads</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> date <span class="op">=</span> <span class="va">dates</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">pays</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>taux_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">taux</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            taux_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">taux</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            taux <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">taux</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'date'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spreads_m</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 422 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   date [211]</span></span></span>
<span><span class="co">#&gt;    date       pays   taux_max taux_min   taux</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2007-01-15 France   0.058<span style="text-decoration: underline;">0</span>   0.013<span style="text-decoration: underline;">0</span> 0.040<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2007-01-15 Italie   0.278    0.154  0.229 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2007-02-15 France   0.056<span style="text-decoration: underline;">0</span>   0.038<span style="text-decoration: underline;">0</span> 0.044<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2007-02-15 Italie   0.284    0.17   0.211 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2007-03-15 France   0.063<span style="text-decoration: underline;">0</span>   0.035<span style="text-decoration: underline;">0</span> 0.046<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2007-03-15 Italie   0.318    0.192  0.239 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2007-04-15 France   0.069<span style="text-decoration: underline;">0</span>   0.041<span style="text-decoration: underline;">0</span> 0.049<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2007-04-15 Italie   0.285    0.153  0.225 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2007-05-15 France   0.098<span style="text-decoration: underline;">0</span>   0.033<span style="text-decoration: underline;">0</span> 0.046<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2007-05-15 Italie   0.291    0.175  0.222 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 412 more rows</span></span></span></code></pre></div>
<p>On peut alors facilement modifier le graphique <code>main</code> en
utilisant <code>%+%</code> (cette instruction modifie les données en
entrée du graphique par le nouveau jeu de données qu’on vient de
construire qui a exactement la même structure, comme on a utilisé les
dates le passage du quotidien au mensuel se fait automatiquement, les
axes sont parfaitement construits) :</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">main</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">spreads_m</span></span></code></pre></div>
<p><img src="graphiques_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>L’insert est le même graphique, en enlevant les annotations, en
simplifiant les axes et en zoomant sur les deux derniers mois.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spreads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">taux</span>, color<span class="op">=</span><span class="va">pays</span>, group<span class="op">=</span><span class="va">pays</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-06-09"</span><span class="op">)</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> linewidth <span class="op">=</span> <span class="fl">0.25</span>, alpha<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>stroke <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="va">cc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_ofce.html">theme_ofce</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>             axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html" class="external-link">label_date_short</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"%Y"</span>, <span class="st">"%B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,</span>
<span>               limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> </span>
<span><span class="va">inset</span></span>
<span><span class="co">#&gt; Warning: Removed 10031 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 10031 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="graphiques_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>On l’insère dans le graphique principal en utilisant
<a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a>, ce qui donne le graphique, plus lisible et
plus élégant.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">main</span> <span class="op">+</span> <span class="va">annotations</span><span class="op">)</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">spreads_m</span></span>
<span><span class="va">main</span>  <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/inset_element.html" class="external-link">inset_element</a></span><span class="op">(</span><span class="va">inset</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 10031 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 10031 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="graphiques_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="interactif">Interactif<a class="anchor" aria-label="anchor" href="#interactif"></a>
</h4>
<p>La dernière étape est l’interctaivité. On utilise le package
<a href="https://davidgohel.github.io/ggiraph/" class="external-link">ggiraph</a> qui va permettre d’intégrer des tooltips très
simplement et très efficacement. On peut aussi avec des sélections
dyanamiques ou encore des zooms.</p>
</div>
<div class="section level4">
<h4 id="double-échelle">double échelle<a class="anchor" aria-label="anchor" href="#double-%C3%A9chelle"></a>
</h4>
<p>Non mais ca va pas ?</p>
</div>
</div>
<div class="section level3">
<h3 id="graphique-xy">Graphique XY<a class="anchor" aria-label="anchor" href="#graphique-xy"></a>
</h3>
<div class="section level4">
<h4 id="interactif-1">interactif<a class="anchor" aria-label="anchor" href="#interactif-1"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="graphiques-en-colonnes-empilées">Graphiques en colonnes empilées<a class="anchor" aria-label="anchor" href="#graphiques-en-colonnes-empil%C3%A9es"></a>
</h3>
<div class="section level4">
<h4 id="interactif-2">interactif<a class="anchor" aria-label="anchor" href="#interactif-2"></a>
</h4>
</div>
<div class="section level4">
<h4 id="alternatives">alternatives<a class="anchor" aria-label="anchor" href="#alternatives"></a>
</h4>
<div class="section level5">
<h5 id="wafle">wafle<a class="anchor" aria-label="anchor" href="#wafle"></a>
</h5>
</div>
<div class="section level5">
<h5 id="treemap">treemap<a class="anchor" aria-label="anchor" href="#treemap"></a>
</h5>
</div>
</div>
</div>
<div class="section level3">
<h3 id="lollypop">Lollypop<a class="anchor" aria-label="anchor" href="#lollypop"></a>
</h3>
<div class="section level4">
<h4 id="interactif-3">interactif<a class="anchor" aria-label="anchor" href="#interactif-3"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="boites-à-moustache">Boites à moustache<a class="anchor" aria-label="anchor" href="#boites-%C3%A0-moustache"></a>
</h3>
<div class="section level4">
<h4 id="interactif-4">interactif<a class="anchor" aria-label="anchor" href="#interactif-4"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="cartes">Cartes<a class="anchor" aria-label="anchor" href="#cartes"></a>
</h3>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
