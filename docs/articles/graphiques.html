<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Faire un graphique ‚Ä¢ ofce</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="graphiques_files/libs/quarto-html/popper.min.js"></script><script src="graphiques_files/libs/quarto-html/tippy.umd.min.js"></script><link href="graphiques_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="graphiques_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Faire un graphique">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ofce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><a class="dropdown-item" href="../articles/blog.html">Le Blog</a></li>
    <li><a class="dropdown-item" href="../articles/outils.html">Outils</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Faire un graphique</h6></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-chartes-graphiques" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Chartes graphiques</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-chartes-graphiques">
<li><a class="dropdown-item" href="../articles/temporelles.html">S√©ries temporelles</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Faire un graphique</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <p>Dans cette (longue) vignette, les recommandations pour les graphiques sont d√©taill√©es.</p>
<p>On commence par des √©l√©ments g√©n√©raux (les 3 m√©thodes), puis des recommandations (une charte graphique) pour les dif√©rents types de graphiques (s√©ries temporelles, cat√©gories, etc) qui sont les plus fr√©quents.</p>
<section class="level2"><h2 id="les-trois-m√©thodes">Les trois m√©thodes<a class="anchor" aria-label="anchor" href="#les-trois-m%C3%A9thodes"></a>
</h2>
<p>Pour les graphiques on dispose de plusieurs options : <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>, copier-coller, fichier image.</p>
<section class="level3"><h3 id="ggplot2">ggplot2<a class="anchor" aria-label="anchor" href="#ggplot2"></a>
</h3>
<p>La fa√ßon pr√©f√©r√©e de faire un graphique est <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>. Elle est la plus flexible, permet d‚Äôavoir une source unique, peut √™tre facilement modifi√©e (uniformisation, traduction, correction, raffinements) et s‚Äôint√®gre parfaitement en html et en pdf.</p>
<p>Avec un faible co√ªt on peut rendre le graphique interactif (avec <a href="https://plotly-r.com" class="external-link">plotly</a> ou <a href="https://davidgohel.github.io/ggiraph/" class="external-link">ggiraph</a>).</p>
<p>Un graphique <code>ggplot</code> doit contenir une couche (layer) <code><a href="../reference/theme_ofce.html">theme_ofce()</a></code> et limiter au maximum les d√©finitions de taille (par exemple de police de caract√®re). Ces d√©finitions doivent √™tre faites de fa√ßon globale pour assurer l‚Äôhomog√©n√©it√©. <strong>Il est important de ne pas d√©finir la taille de la figure, √ßa risque de produire des images avec des caract√®res trop petits</strong>.</p>
<p>Pour changer les dimensions d‚Äôun graphique, il faut utiliser<a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;donc on n‚Äôutilise pas &lt;code&gt;#| fig-width&lt;/code&gt; ou &lt;code&gt;fig-height&lt;/code&gt;.&lt;/p&gt;"><sup>1</sup></a> <code>#| fig-asp : x</code> ou <code>x</code> est le ratio entre la hauteur et la longueur. 0.61 est la valeur par d√©faut et correspond au nombre d‚Äôor soit entre 16/9 et 16/10. Pour des graphiques particuliers (par exemple deux graphiques empil√©s ou une carte) on peut mettre 1 (format carr√©) ou 1.4 quand on veut prendre toute la page A4.</p>
<p>Le code d‚Äôun graphique <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| label: fig-tauxapp</span></span>
<span><span class="co">#| fig-cap: Taux de taxation apparent sur le patrimoine des m√©nages</span></span>
<span><span class="co">#| fig-asp: 0.61</span></span>
<span><span class="co"># pas besoin d'en mettre plus, echo, message, warning sont d√©j√† d√©finis</span></span>
<span><span class="co"># les donn√©es sont dans excel -- elles pourraient venir de R ou d'ailleurs</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="st">"analyses/Tables/patrimoine menages.v2.xlsx"</span>, sheet <span class="op">=</span> <span class="st">"tapp"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"vn"</span>, <span class="st">"pib"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ym</a></span><span class="op">(</span><span class="fu">str_c</span><span class="op">(</span><span class="va">date</span>, <span class="st">"-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vn</span>, <span class="va">pib</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vn"</span>, <span class="st">"pib"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"En % de la valeur nette"</span>, <span class="st">"En % du PIB"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                       </span>
<span><span class="co"># un ggplot et ses diff√©rentes couches</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">name</span>, col <span class="op">=</span> <span class="va">name</span>, fill <span class="op">=</span> <span class="va">name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, col <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># important utiliser le theme_ofce pour uniformiser l'aspect des graphiques</span></span>
<span>  <span class="fu"><a href="../reference/theme_ofce.html">theme_ofce</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scale date est important lorsqu'on pr√©sente des donn√©es temporelles</span></span>
<span>  <span class="co"># il faut penser √† convertir les dates en dates (as.Date() ou lubridate::ymd() et consorts)</span></span>
<span>  <span class="co"># c'est important m√™me si les dates ne sont que des ann√©es</span></span>
<span>  <span class="co"># ca permet aussi de m√©langer facilement des fr√©quences diff√©rentes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"2 years"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span>, </span>
<span>               date_minor_breaks <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># le choix des couleurs est tjrs d√©licat, Paul Malliet est un ma√Ætre en la mati√®re</span></span>
<span>  <span class="co"># uniformiser ses choix de couleurs le long d'un document c'est bien</span></span>
<span>  <span class="co"># donner une signification √† ses couleurs c'est mieux</span></span>
<span>  <span class="co"># quand en plus c'est harmonieux, c'est PM (plus que mieux ou Paul Malliet)</span></span>
<span>  <span class="fu">PrettyCols</span><span class="fu">::</span><span class="fu"><a href="https://nrennie.github.io/PrettyCols/reference/scale_color_pretty_d.html" class="external-link">scale_color_pretty_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, palette <span class="op">=</span> <span class="st">"Summer"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">PrettyCols</span><span class="fu">::</span><span class="fu"><a href="https://nrennie.github.io/PrettyCols/reference/scale_fill_pretty_d.html" class="external-link">scale_fill_pretty_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, palette <span class="op">=</span> <span class="st">"Summer"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"%"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># les sources -- notez qu'on ne met pas de titre au graphique </span></span>
<span>  <span class="co"># (voir la section r√©f√©rences crois√©es)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span></span>
<span>         <span class="st">"La fiscalit√© sur le patrimoine est compos√©e ici de la taxe fonci√®re pay√©e par les m√©nages, &lt;br&gt;</span></span>
<span><span class="st">       des droits d'enregistrement sur les transactions immobili√®res, des droits de mutation sur les successions et les donations et de l'Imp√¥t sur la Fortune Immobili√®re (ex-ISF)&lt;br&gt;</span></span>
<span><span class="st">       *Sources* : Insee, calculs OFCE"</span><span class="op">)</span></span></code></pre></div>
</section><section class="level3"><h3 id="copier-coller">Copier-coller<a class="anchor" aria-label="anchor" href="#copier-coller"></a>
</h3>
<p>On peut copier coller un graphique (de word, d‚Äôexcel, d‚Äôailleurs) dans le mode visuel de RStudio. √áa marche mais c‚Äôest pas le mieux. Quand on copie colle, on fait quelque chose qui ressemble √† l‚Äôoption qui suit.</p>
</section><section class="level3"><h3 id="image-au-format-pngjpegjpgsvg">Image au format png/jpeg/jpg/svg<a class="anchor" aria-label="anchor" href="#image-au-format-pngjpegjpgsvg"></a>
</h3>
<p>On peut enregistrer une image (au format que l‚Äôon veut, <code>quarto</code> accepte pas mal d‚Äôoptions, dont les plus courantes) et l‚Äôins√©rer dans le texte. Il y a deux fa√ßon de faire soit en <code>markdown</code> (dans le qmd, comme un lien ou autre chose), soit en utilisant <code>include_graphics</code>. L‚Äôint√©r√™t par rapport au copier-coller est que si on change le fichier qui contient l‚Äôimage, √† chaque <em>render</em> du document, la bonne (la derni√®re version) image sera utilis√©e. Si on utilise des images venant de <code>eviews</code> üíÄ ou <code>stata</code> üòµ, c‚Äôest la meilleure m√©thode.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Titre de la figure</span><span class="co">](rep/fig.png)</span></span></code></pre></div>
<p>Le <strong>r√©pertoire est toujours relatif</strong>.</p>
<p><em>Jamais de chemin absolu</em> comme ‚Äú<code>c:/user/machin/montravail/monrepo/monimage.png</code>‚Äù parce que √ßa ne marchera pas sur un autre ordinateur et en plus <code>github</code> ne copiera pas l‚Äôimage) et par celui qui contient le <code>.qmd</code>. Il est toujours possible de mettre les images dans un sous dossier.</p>
<p>Plus c‚Äôest simple et clair, mieux c‚Äôest (i.e.¬†gardez les noms courts, explicites, pas de majuscules, bien rang√©s, conservateurs dans l‚Äôutilisation des caract√®res (<strong>pas d‚Äôaccents, pas de blancs, pas de symboles sp√©ciaux</strong>). Donc <code>donnees/img.png</code> ou <code>donnees/graphique 1a5.png</code> ne sont pas des bons noms. Mais <code>figures/revenu.png</code> ou <code>figures/pib_par_tete.png</code> sont mieux.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#| label fig-pib2008_2024</span></span>
<span><span class="co">#| fig-cap: PIB entre 2008 et 2024</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"pib2008_2024.png"</span><span class="op">)</span></span></code></pre></div>
<p>Notez la coh√©rence des id, nom et titre.</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
