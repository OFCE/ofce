<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Séries temporelles • ofce</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="temporelles_files/libs/quarto-html/popper.min.js"></script><script src="temporelles_files/libs/quarto-html/tippy.umd.min.js"></script><link href="temporelles_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="temporelles_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Séries temporelles">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ofce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><a class="dropdown-item" href="../articles/blog.html">Le Blog</a></li>
    <li><a class="dropdown-item" href="../articles/outils.html">Outils</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Faire un graphique</h6></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-chartes-graphiques" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Chartes graphiques</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-chartes-graphiques">
<li><a class="dropdown-item" href="../articles/temporelles.html">Séries temporelles</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Séries temporelles</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="section level2"><h2 id="séries-temporelles">Séries temporelles<a class="anchor" aria-label="anchor" href="#s%C3%A9ries-temporelles"></a>
</h2>
<section class="level2"><h3 id="données">données<a class="anchor" aria-label="anchor" href="#donn%C3%A9es"></a>
</h3>
<p>Pour les séries temporelles, il y a deux recommandations pour les données :</p>
<ol type="1">
<li><p>utilisez le format long pour le graphique. Il peut être plus simple pour calculer des taux de croissance ou des ratios de passer en format large, mais c’est mieux de passer en format long pour la partie graphique, avec une ou plusieurs colonnes pour différencier les lignes. Cela permettra d’associer une couleur à chaque série et une facette à chque pays par exemple.</p></li>
<li><p>le champ décrivant les dates doit être en type <code>date</code>. ce n’est pas toujours évident quand les séries sont à fréquence annuelle, mais c’est très utile pour mélanger des séries de fréquence irrégulière, pour homogénéiser l’aspect des axes de dates ert mieux maîtriser le formatage des dates. Pour convertir une date en date, soit elle est au format charactere et de type “2022-12-01” et la fonction <code><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">base::as.Date()</a></code> fonctionne très bien. Sinon, pur les autres cas, le package <a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a> (formation R niv. 1) est très pratique et dispose de plein de fonctions permettant d’absorber beaucoup de cas (les fonctions sont par exemple <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::ymd</a></code> <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::dmy</a></code> <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">lubridate::my</a></code> etc…).</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2023</span>, <span class="fl">2024</span>, <span class="fl">2025</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span>, format  <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-07-08" "2024-07-08" "2025-07-08"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1/2023"</span>, <span class="st">"2/2024"</span>, <span class="st">"3/2025"</span><span class="op">)</span></span>
<span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">my</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-01-01" "2024-02-01" "2025-03-01"</code></pre>
</div>
</div>
<p>Prenons l’exemple du graphiques sur les spreads (legislatives2024, Blot Gerrolf Plane). Les données sont égénrées par un scrapping sur investing.com (en attendant une solution API sur une banque de données bien faite). Les données se présentent sous la forme.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ofce.github.io/ofce/">ofce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spreads</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,117 × 3
   date       pays        taux
   &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;
 1 2007-01-02 spreadfra 0.0130
 2 2007-01-03 spreadfra 0.0360
 3 2007-01-04 spreadfra 0.0280
 4 2007-01-05 spreadfra 0.0190
 5 2007-01-08 spreadfra 0.0440
 6 2007-01-09 spreadfra 0.0430
 7 2007-01-10 spreadfra 0.0290
 8 2007-01-11 spreadfra 0.0370
 9 2007-01-12 spreadfra 0.0340
10 2007-01-15 spreadfra 0.0380
# ℹ 10,107 more rows</code></pre>
</div>
</div>
<p>Le fichier est au format long (avec deux modalités pour <code>pays</code>), les dates sont au format <code>&lt;date&gt;</code>, donc tout va presque bien. La colonne <code>pays</code> est un peu brute. On la transforme pour avoir un label plus propre et en facteur, pour contrôler l’ordre (on met France en premier, Italie en second). Il y a plusieurs méthodes pour arriver à ce résultat. Ici, on reste très simple parce qu’il n’y a que deux modalités. Si il y en avait plus de deux (et surtout un grand nombre, possiblement évolutif), on aurait fait quelques manipulations de chaînes et on aurait utilisé le package <a href="https://vincentarelbundock.github.io/countrycode/" class="external-link">countrycode</a> pour transformer les code pays en texte lisible, possiblement traduit dans différentes langues.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spreads</span> <span class="op">&lt;-</span> <span class="va">spreads</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span> <span class="va">pays</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spreadfra"</span>, <span class="st">"spreadita"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"France"</span>, <span class="st">"Italie"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spreads</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,117 × 3
   date       pays     taux
   &lt;date&gt;     &lt;fct&gt;   &lt;dbl&gt;
 1 2007-01-02 France 0.0130
 2 2007-01-03 France 0.0360
 3 2007-01-04 France 0.0280
 4 2007-01-05 France 0.0190
 5 2007-01-08 France 0.0440
 6 2007-01-09 France 0.0430
 7 2007-01-10 France 0.0290
 8 2007-01-11 France 0.0370
 9 2007-01-12 France 0.0340
10 2007-01-15 France 0.0380
# ℹ 10,107 more rows</code></pre>
</div>
</div>
</section><section class="level2"><h3 id="la-base-du-graphique">la base du graphique<a class="anchor" aria-label="anchor" href="#la-base-du-graphique"></a>
</h3>
<p>Le graphique de base est alors simple à contruire. On utilise une couche <code>geom_line</code> et <code>geom_point</code>, une couche <code>aes</code> avec comme <code>x</code> les dates, <code>y</code> les taux et couleurs les pays. Pour <code>geom_line</code>, il faut préciser le groupe (cela peut paraître redondant, mais cela peut servir si on veut colorer en fonction d’une autre variable).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ofce.github.io/ofce/">ofce</a></span><span class="op">)</span></span>
<span><span class="va">cc</span> <span class="op">&lt;-</span> <span class="fu">PrettyCols</span><span class="fu">::</span><span class="fu"><a href="https://nrennie.github.io/PrettyCols/reference/prettycols.html" class="external-link">prettycols</a></span><span class="op">(</span><span class="st">"Summer"</span>, n<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">date_maj</span> <span class="op">&lt;-</span> <span class="st">"2024-07-01"</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spreads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">taux</span>, color<span class="op">=</span><span class="va">pays</span>, group<span class="op">=</span><span class="va">pays</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.75</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>stroke <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="va">cc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y<span class="op">=</span><span class="st">"Ecart de taux à 10 ans en %"</span>,</span>
<span>    x<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>    caption<span class="op">=</span><span class="st">"Source: investing.com"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_ofce.html">theme_ofce</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>minor.ticks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>         y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>minor.ticks <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"*Source* : investing.com&lt;br&gt;Mis à jour : {date_maj}"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html" class="external-link">label_date_short</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               date_breaks <span class="op">=</span> <span class="st">"5 years"</span><span class="op">)</span></span>
<span><span class="va">main</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 858 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure><p><img src="temporelles_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On utilise la palette <code>summer</code> de <a href="https://nrennie.rbind.io/PrettyCols/" class="external-link">PrettyCols</a> (affaire de goût). On utilise la fonction <code><a href="../reference/theme_ofce.html">theme_ofce()</a></code> pour homogénéiser la présentation des graphiques. On précise les labels des axes inutile pour <code>x</code>, explicite pour <code>y</code>. Et la source, en notant que l’on peut utiliser <code>markdown</code> dans le texte de la source, ce qui permet de mettre <em>Source</em> en italique.</p>
<p>Le recours à <code>scale_x_date</code> permet de spécifier facilement le format des dates (avec la syntaxe de <code><a href="https://rdrr.io/r/base/strptime.html" class="external-link">base::strptime()</a></code>) et la fonction <code>scale::label_date_short()</code> permet un formatage élégant des dates (voir plus bas la partie insert).</p>
<p>On ajoute au graphique des annotations. C’est ici faid de façon laborieuse, on peut construire des fonctions (formation R niv. 2) ou utiliser <a href="https://dreamrs.github.io/esquisse/" class="external-link">esquisse</a> ou <code>{gganotate}</code> mais ces deux solutions ont des défauts.</p>
</section><section class="level2"><h3 id="les-annotations">les annotations<a class="anchor" aria-label="anchor" href="#les-annotations"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotations</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-12-01"</span><span class="op">)</span>, y<span class="op">=</span> <span class="fl">1</span>, </span>
<span>    label<span class="op">=</span><span class="st">"France"</span> , color<span class="op">=</span><span class="va">cc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> , size<span class="op">=</span><span class="fl">3</span>, fontface <span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-06-01"</span><span class="op">)</span>, y<span class="op">=</span> <span class="fl">3</span> ,</span>
<span>    label<span class="op">=</span><span class="st">"Italie"</span> , color<span class="op">=</span><span class="va">cc</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, size<span class="op">=</span><span class="fl">3</span>, fontface <span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>, </span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2009-12-01"</span><span class="op">)</span>, </span>
<span>    y<span class="op">=</span> <span class="fl">5</span> , </span>
<span>    label<span class="op">=</span><span class="st">"Crise des dettes souveraines\n26 juillet 2012 : Mario Draghi \n 'Whatever it takes'"</span> ,</span>
<span>    color<span class="op">=</span> <span class="st">"grey33"</span>, </span>
<span>    size<span class="op">=</span><span class="fl">2</span>,</span>
<span>    hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>, </span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-03-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-07-01"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">5</span>, </span>
<span>    yend <span class="op">=</span> <span class="fl">4.6</span>, </span>
<span>    colour <span class="op">=</span> <span class="st">"grey33"</span>,</span>
<span>    linewidth<span class="op">=</span><span class="fl">0.25</span>,</span>
<span>    arrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"point"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-9-01"</span><span class="op">)</span>,</span>
<span>    y<span class="op">=</span> <span class="fl">4.5</span> ,</span>
<span>    size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    label<span class="op">=</span><span class="st">"4 mars 2018 : Élections italiennes\n1er juin : gouvernement de coalition"</span> ,</span>
<span>    color<span class="op">=</span> <span class="st">"grey33"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2017-09-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-05-01"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">4.2</span>,</span>
<span>    yend <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey33"</span>, </span>
<span>    linewidth<span class="op">=</span><span class="fl">0.25</span>, </span>
<span>    arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"point"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, </span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    y<span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>    label<span class="op">=</span><span class="st">"Annonce de la dissolution"</span> , </span>
<span>    color<span class="op">=</span> <span class="st">"grey33"</span>,</span>
<span>    size<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    <span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-03-01"</span><span class="op">)</span>, </span>
<span>    xend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-04-01"</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fl">0.8</span>, </span>
<span>    yend <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>    colour <span class="op">=</span> <span class="st">"grey33"</span>,</span>
<span>    linewidth<span class="op">=</span><span class="fl">0.25</span>,</span>
<span>    arrow<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"point"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">main</span> <span class="op">+</span> <span class="va">annotations</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 858 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure><p><img src="temporelles_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le résultat est intéressant, mais le graphique a cependant un défaut, il y a trop de points, ce qui est du à la fréquence quotidienne et donc il perd en clarté. On va donc faire deux choses : réduire la fréquence en agrégeant les données par mois, puis on va ajouter un insert.</p>
</section><section class="level2"><h3 id="fréquence-mensuelle-et-insert">fréquence mensuelle et insert<a class="anchor" aria-label="anchor" href="#fr%C3%A9quence-mensuelle-et-insert"></a>
</h3>
<p>Pour construire les données à la fréquence mensuelle, on va créer un champ de date, mais retenant une seule date par mois (au milieu du mois).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="va">spreads</span><span class="op">$</span><span class="va">date</span></span>
<span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span><span class="va">spreads_m</span> <span class="op">&lt;-</span> <span class="va">spreads</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> date <span class="op">=</span> <span class="va">dates</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">pays</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>taux_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">taux</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            taux_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">taux</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            taux <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">taux</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spreads_m</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 422 × 5
# Groups:   date [211]
   date       pays   taux_max taux_min   taux
   &lt;date&gt;     &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
 1 2007-01-15 France   0.0580   0.0130 0.0409
 2 2007-01-15 Italie   0.278    0.154  0.229
 3 2007-02-15 France   0.0560   0.0380 0.0440
 4 2007-02-15 Italie   0.284    0.17   0.211
 5 2007-03-15 France   0.0630   0.0350 0.0466
 6 2007-03-15 Italie   0.318    0.192  0.239
 7 2007-04-15 France   0.0690   0.0410 0.0496
 8 2007-04-15 Italie   0.285    0.153  0.225
 9 2007-05-15 France   0.0980   0.0330 0.0464
10 2007-05-15 Italie   0.291    0.175  0.222
# ℹ 412 more rows</code></pre>
</div>
</div>
<p>On peut alors facilement modifier le graphique <code>main</code> en utilisant <code>%+%</code> (cette instruction modifie les données en entrée du graphique par le nouveau jeu de données qu’on vient de construire qui a exactement la même structure, comme on a utilisé les dates le passage du quotidien au mensuel se fait automatiquement, les axes sont parfaitement construits) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">main</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">spreads_m</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="temporelles_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>L’insert est le même graphique, en enlevant les annotations, en simplifiant les axes et en zoomant sur les deux derniers mois.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">spreads</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">date</span>, y<span class="op">=</span><span class="va">taux</span>, color<span class="op">=</span><span class="va">pays</span>, group<span class="op">=</span><span class="va">pays</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-06-09"</span><span class="op">)</span>,</span>
<span>             linewidth <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span> linewidth <span class="op">=</span> <span class="fl">0.25</span>, alpha<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>stroke <span class="op">=</span> <span class="fl">0.1</span>, size <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, values <span class="op">=</span> <span class="va">cc</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_ofce.html">theme_ofce</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">7</span>,</span>
<span>             axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_date.html" class="external-link">label_date_short</a></span><span class="op">(</span>format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"%Y"</span>, <span class="st">"%B"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               date_breaks <span class="op">=</span> <span class="st">"1 month"</span>,</span>
<span>               limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> </span>
<span><span class="va">inset</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 10033 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 10033 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure><p><img src="temporelles_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On l’insère dans le graphique principal en utilisant <a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a>, ce qui donne le graphique, plus lisible et plus élégant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">main</span> <span class="op">+</span> <span class="va">annotations</span><span class="op">)</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">spreads_m</span></span>
<span><span class="va">main</span>  <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/inset_element.html" class="external-link">inset_element</a></span><span class="op">(</span><span class="va">inset</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 10033 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 10033 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure><p><img src="temporelles_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h3 id="interactif">Interactif<a class="anchor" aria-label="anchor" href="#interactif"></a>
</h3>
<p>La dernière étape est l’interctaivité. On utilise le package <a href="https://davidgohel.github.io/ggiraph/" class="external-link">ggiraph</a> qui va permettre d’intégrer des tooltips très simplement et très efficacement. On peut aussi avec des sélections dyanamiques ou encore des zooms.</p>
</section><section class="level2"><h3 id="double-échelle">double échelle<a class="anchor" aria-label="anchor" href="#double-%C3%A9chelle"></a>
</h3>
<p>Non mais ca va pas ?</p>
</section></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
