<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • ofce</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Open_Sans-0.4.10/font.css" rel="stylesheet"><link href="deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://ofce.github.io/ofce/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">ofce</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.27</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-manuels" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Manuels</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-manuels"><li><a class="dropdown-item" href="articles/site.html">Sites dédiés</a></li>
    <li><a class="dropdown-item" href="articles/blog.html">Le Blog</a></li>
    <li><a class="dropdown-item" href="articles/quarto.html">Ecrire un texte en quarto</a></li>
    <li><a class="dropdown-item" href="articles/graphiques.html">Faire un graphique</a></li>
    <li><a class="dropdown-item" href="articles/tableaux.html">Faire un tableau</a></li>
    <li><a class="dropdown-item" href="articles/outils.html">Les outils</a></li>
    <li><a class="dropdown-item" href="articles/semio.html">Le language des graphiques</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutoriaux" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutoriaux</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutoriaux"><li><a class="dropdown-item" href="articles/charte_graphique.html">Charte Graphique</a></li>
    <li><a class="dropdown-item" href="articles/prevision.html">Charte Graphique pour la Prévision</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/temporelles.html">Séries temporelles</a></li>
    <li><a class="dropdown-item" href="articles/xy.html">Graphiques XY</a></li>
    <li><a class="dropdown-item" href="articles/categories.html">Barres empilées, wafle, treemap, lollypop</a></li>
    <li><a class="dropdown-item" href="articles/distributions.html">Distributions</a></li>
    <li><a class="dropdown-item" href="articles/cartes.html">Cartes</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/source_data.html">Caché et robuste</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/qa.html">Quand ça ne marche pas</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ofce/ofce"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>CLAUDE.md</h1>

    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>The <code>ofce</code> package is an R package for creating scientific documents following OFCE (Observatoire français des conjonctures économiques) standards. It provides: - ggplot2 themes and color palettes following OFCE/Revue graphical standards - Quarto templates for working papers, blogs, presentations, and websites - French-language formatting utilities - Integration with marquee for advanced text rendering</p>
<p>The package is primarily for French economic research publications, with French as the default language.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="building-and-testing">Building and Testing<a class="anchor" aria-label="anchor" href="#building-and-testing"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install package in development mode</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build documentation</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">document</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build and check package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build pkgdown site</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install from local source</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="common-development-tasks">Common Development Tasks<a class="anchor" aria-label="anchor" href="#common-development-tasks"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test a specific function interactively</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># Your test code here</span></span>
<span></span>
<span><span class="co"># Run examples from a function</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/run_examples.html" class="external-link">run_examples</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package for CRAN compliance</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="core-components">Core Components<a class="anchor" aria-label="anchor" href="#core-components"></a></h3>
<p><strong>Quarto Templates System</strong> (<code>R/quarto.R</code>, <code>inst/extdata/templates/</code>) - <code><a href="reference/setup_quarto.html">setup_quarto()</a></code>: Installs OFCE Quarto extensions to a project - <code><a href="reference/setup_wp.html">setup_wp()</a></code>, <code><a href="reference/setup_blog.html">setup_blog()</a></code>, <code><a href="reference/setup_graph.html">setup_graph()</a></code>, <code><a href="reference/setup_pres.html">setup_pres()</a></code>: Initialize specific document types with templates - Templates stored in <code>inst/extdata/templates/</code> (blog, graph, presentation, website, workingpaper) - Extensions pulled from <code>ofce/ofce-quarto-extensions</code> repository</p>
<p><strong>Theme System</strong> (<code>R/theme_ofce.R</code>) - <code><a href="reference/theme_ofce.html">theme_ofce()</a></code>: Main ggplot2 theme for OFCE graphics following Revue de l’OFCE standards - <code><a href="reference/theme_ofce_void.html">theme_ofce_void()</a></code>: Simplified theme for maps and minimal graphics - Supports both marquee (advanced markdown text rendering) and standard ggplot2 text elements - Configurable via global options: <code>ofce.base_size</code>, <code>ofce.base_family</code>, <code>ofce.marquee</code>, <code>ofce.background_color</code></p>
<p><strong>Caption System</strong> (<code>R/ofce_caption.R</code>) - <code><a href="reference/ofce_caption.html">ofce_caption()</a></code>: Creates standardized captions for ggplot2 graphics with source, note, lecture, champ, code - <code><a href="reference/ofce_caption_gt.html">ofce_caption_gt()</a></code>: Caption system for gt tables - <code><a href="reference/dernier_point.html">dernier_point()</a></code>: Formats “last known data point” dates in French or English - Supports glue string interpolation and marquee markdown transformations (<sup>x</sup> → superscript, <sub>x</sub> → subscript)</p>
<p><strong>Palette System</strong> (multiple files) - <code>R/ofce_palette*.R</code>: Color palettes (main, sequential, diverging, country-specific) - <code>R/scale_color_pays.R</code>: Country-specific color scales - Data stored in <code>inst/palette.ofce.rda</code></p>
<p><strong>Graph Export</strong> (<code>R/graph2xxx.R</code>) - <code><a href="reference/graph2png.html">graph2png()</a></code>, <code><a href="reference/graph2svg.html">graph2svg()</a></code>, <code>graph2pptx()</code>: Export graphics in various formats - Handles ggplot2 and tmap objects - Default size: 18cm width, 4:3 ratio - Uses showtext for proper font rendering at high DPI (default 600)</p>
<p><strong>Formatting Utilities</strong> (<code>R/formate.R</code>) - <code><a href="reference/fmt_val.html">fmt_val()</a></code>: Format numbers in French style (comma as decimal, space as thousands separator) - <code><a href="reference/fmt_pct.html">fmt_pct()</a></code>: Format percentages - <code><a href="reference/fmt_mds.html">fmt_mds()</a></code>: Format billions of euros (Milliards d’euros)</p>
<p><strong>Initialization System</strong> (<code>R/init_qmd.R</code>, <code>inst/rinit.r</code>) - <code><a href="reference/init_qmd.html">init_qmd()</a></code>: Sources project-specific or package <code>rinit.r</code> at document start - <code><a href="reference/pathify.html">pathify()</a></code>: Resolves paths from project root (paths starting with <code>/</code>) - Default <code>rinit.r</code> sets up fonts, themes, knitr options, common libraries, and French locale</p>
</div>
<div class="section level3">
<h3 id="key-design-patterns">Key Design Patterns<a class="anchor" aria-label="anchor" href="#key-design-patterns"></a></h3>
<p><strong>Global Options</strong> The package heavily uses R options for configuration: - <code>ofce.base_size</code>: Base font size (default 12) - <code>ofce.base_family</code>: Font family (default “Open Sans”) - <code>ofce.marquee</code>: Enable marquee text rendering (default TRUE) - <code>ofce.background_color</code>: Background color (default “transparent”) - <code>ofce.caption.*</code>: Caption formatting options (wrap, lang, ofce branding, glue interpolation)</p>
<p><strong>Font System</strong> - Uses Open Sans as default font (included in <code>inst/fonts/</code>) - Relies on showtext/sysfonts for rendering - systemfonts used to register fonts in rinit.r</p>
<p><strong>Marquee vs Standard Text</strong> - When <code>ofce.marquee = TRUE</code>: Uses <code><a href="https://marquee.r-lib.org/reference/element_marquee.html" class="external-link">marquee::element_marquee()</a></code> for advanced markdown rendering in ggplot2 - When <code>ofce.marquee = FALSE</code>: Falls back to standard <code><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">ggplot2::element_text()</a></code> - This dual system allows for rich text formatting while maintaining compatibility</p>
<p><strong>French Language Defaults</strong> - All user-facing text defaults to French - Date formatting uses French locale - Caption labels: “Source”, “Lecture”, “Note”, “Champ”, “Code”, “Dernier point connu” - Most functions have <code>lang</code> parameter for English output</p>
</div>
</div>
<div class="section level2">
<h2 id="important-files">Important Files<a class="anchor" aria-label="anchor" href="#important-files"></a></h2>
<ul><li>
<code>DESCRIPTION</code>: Package metadata, dependencies (requires R &gt;= 4.2, Quarto CLI)</li>
<li>
<code>inst/rinit.r</code>: Default initialization script sourced by <code><a href="reference/init_qmd.html">init_qmd()</a></code>
</li>
<li>
<code>inst/extdata/templates/</code>: Quarto document templates</li>
<li>
<code>inst/fonts/</code>: OpenSans font files</li>
<li>
<code>_pkgdown.yml</code>: Documentation website configuration</li>
<li>
<code>.Rbuildignore</code>: Files to exclude from package builds</li>
</ul></div>
<div class="section level2">
<h2 id="common-workflows">Common Workflows<a class="anchor" aria-label="anchor" href="#common-workflows"></a></h2>
<div class="section level3">
<h3 id="adding-a-new-graphical-theme-element">Adding a New Graphical Theme Element<a class="anchor" aria-label="anchor" href="#adding-a-new-graphical-theme-element"></a></h3>
<ol style="list-style-type: decimal"><li>Edit <code>R/theme_ofce.R</code>
</li>
<li>Update both marquee and non-marquee versions</li>
<li>Test with <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all()</a></code> and create example plots</li>
<li>Document changes and rebuild with <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code>
</li>
</ol></div>
<div class="section level3">
<h3 id="creating-a-new-quarto-template">Creating a New Quarto Template<a class="anchor" aria-label="anchor" href="#creating-a-new-quarto-template"></a></h3>
<ol style="list-style-type: decimal"><li>Add template files to <code>inst/extdata/templates/[type]/</code>
</li>
<li>Create setup function in <code>R/quarto.R</code> (e.g., <code>setup_[type]()</code>)</li>
<li>Update <code><a href="reference/setup_quarto.html">setup_quarto()</a></code> documentation to mention new format</li>
<li>Test installation with <code><a href="reference/setup_quarto.html">setup_quarto()</a></code> in a test directory</li>
</ol></div>
<div class="section level3">
<h3 id="modifying-color-palettes">Modifying Color Palettes<a class="anchor" aria-label="anchor" href="#modifying-color-palettes"></a></h3>
<ol style="list-style-type: decimal"><li>Edit palette data in <code>data/</code> directory</li>
<li>Update corresponding <code>R/ofce_palette*.R</code> file</li>
<li>Regenerate <code>inst/palette.ofce.rda</code> if needed</li>
<li>Update documentation and examples</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p><strong>Critical Dependencies</strong> - ggplot2 &gt;= 4.0.0: Core graphics system - marquee &gt;= 1.2.0: Advanced text rendering - gt &gt;= 1.1.0: Table formatting - quarto: Document rendering (requires Quarto CLI installed) - showtext/sysfonts: Font rendering</p>
<p><strong>Data Processing</strong> - tidyverse &gt;= 2.0.0 (dplyr, tidyr, purrr, stringr) - data.table: High-performance data manipulation</p>
<p><strong>Utility</strong> - glue: String interpolation - fs: File system operations - lubridate: Date handling</p>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a></h2>
<ul><li>The package website is hosted at <a href="https://ofce.github.io/ofce/" class="uri">https://ofce.github.io/ofce/</a>
</li>
<li>Documentation includes extensive vignettes for different chart types, Quarto usage, and graphic standards</li>
<li>This is a specialized package for OFCE institutional use, not intended for CRAN</li>
<li>Uses CC BY 4.0 license</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Malliet, Anissa Saumtally, Xavier Timbeau.</p>
</div>

<div class="pkgdown-footer-right">
  <p>RTFM CC BY 4.0 Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

